@model List<GreenAgriApp.Models.Category>
@{
    ViewData["Title"] = "Manage Farmer Categories";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/agriconnect-form.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<section class="form-hero-section">
    <h1>Manage Farmer Categories</h1>
    <p>View, update, and manage category statuses below.</p>
</section>

<div class="category-search-wrapper">
    <input type="text" id="searchBox" onkeyup="filterCategories()" placeholder="ðŸ” Search for a category..." class="fancy-search-box" />
</div>

<div id="categoryContainer" class="card-list-wrapper">
    @foreach (var category in Model)
    {
        <div class="category-card" data-name="@category.Name.ToLower()">
            <h3>@category.Name</h3>
            <p>Status: <strong id="status-@category.Id">@category.Status</strong></p>
            <div class="card-actions">
                <select class="styled-select" onchange="updateStatus(@category.Id, this.value)">
                    <option disabled selected value="">Change status</option>
                    <option value="Pending">Pending</option>
                    <option value="Approved">Approved</option>
                    <option value="Rejected">Rejected</option>
                </select>
                <div class="card-delete-wrapper">
                    <form asp-action="DeleteCategory" method="get" asp-controller="Employee" asp-route-id="@category.Id">
                        <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this category?')">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
<script>
    function updateStatus(categoryId, newStatus) {
        fetch('/Employee/UpdateCategoryStatus', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: categoryId, status: newStatus })
        })
        .then(response => response.text())
        .then(result => {
            document.getElementById('status-' + categoryId).innerText = newStatus;
        });
    }

    function filterCategories() {
        const keyword = document.getElementById('searchBox').value.toLowerCase();
        const cards = document.querySelectorAll('.category-card');

        cards.forEach(card => {
            const name = card.getAttribute('data-name');
            card.style.display = name.includes(keyword) ? 'block' : 'none';
        });
    }
</script>
}

</body>
</html>
